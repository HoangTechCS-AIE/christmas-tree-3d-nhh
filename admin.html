<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Qu·∫£n L√Ω L·ªùi Ch√∫c</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: #d4af37;
            text-align: center;
        }

        .login-box,
        .dashboard {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .hidden {
            display: none;
        }

        input[type="password"],
        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #404040;
            border: 1px solid #555;
            color: #fff;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background: #d4af37;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            transition: background 0.3s;
        }

        button:hover {
            background: #fceea7;
        }

        .wish-item {
            background: #404040;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px;
        }

        .wish-text {
            flex-grow: 1;
            margin-right: 10px;
        }

        .delete-btn {
            background: #ff4444;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <h1>üéÅ Qu·∫£n L√Ω L·ªùi Ch√∫c</h1>

    <div id="login-section" class="login-box">
        <h3>ƒêƒÉng nh·∫≠p Admin</h3>
        <input type="password" id="admin-pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u Admin...">
        <button onclick="login()">V√†o Qu·∫£n L√Ω</button>
        <p id="login-msg" style="color: red;"></p>
    </div>

    <div id="dashboard" class="dashboard hidden">
        <div style="display:flex; gap:10px; margin-bottom: 20px;">
            <input type="text" id="new-wish" placeholder="Nh·∫≠p l·ªùi ch√∫c m·ªõi...">
            <button onclick="addWish()">Th√™m</button>
        </div>
        <div id="wish-list">
            <!-- List goes here -->
        </div>
        <div style="margin-top: 20px; text-align: right;">
            <button onclick="saveAll()" style="background: #4CAF50; color: white;">L∆∞u Thay ƒê·ªïi</button>
        </div>
        <p id="status-msg" style="margin-top: 10px; color: yellow;"></p>
    </div>

    <script>
        let currentWishes = [];
        let adminToken = '';

        function login() {
            const pass = document.getElementById('admin-pass').value;
            // Test connection
            fetch('/api/wishes', {
                headers: { 'x-admin-password': pass }
            })
                .then(async res => {
                    if (res.ok) return res.json();
                    const errData = await res.json().catch(() => ({}));
                    throw new Error(errData.error || 'L·ªói server (Check Console)');
                })
                .then(data => {
                    adminToken = pass;
                    currentWishes = data;
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    renderList();
                })
                .catch(err => {
                    document.getElementById('login-msg').innerText = err.message;
                });
        }

        function renderList() {
            const list = document.getElementById('wish-list');
            list.innerHTML = '';
            currentWishes.forEach((w, i) => {
                const div = document.createElement('div');
                div.className = 'wish-item';
                div.innerHTML = `
                    <input type="text" class="wish-text" value="${w}" onchange="updateWish(${i}, this.value)">
                    <button class="delete-btn" onclick="removeWish(${i})">X√≥a</button>
                `;
                list.appendChild(div);
            });
        }

        function addWish() {
            const input = document.getElementById('new-wish');
            const val = input.value.trim();
            if (val) {
                currentWishes.push(val);
                input.value = '';
                renderList();
            }
        }

        function removeWish(index) {
            currentWishes.splice(index, 1);
            renderList(); // Re-render immediately
        }

        function updateWish(index, val) {
            currentWishes[index] = val;
        }

        function saveAll() {
            const btn = document.querySelector('button[onclick="saveAll()"]');
            const originalText = btn.innerText;
            btn.innerText = "ƒêang l∆∞u...";
            btn.disabled = true;

            fetch('/api/wishes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-admin-password': adminToken
                },
                body: JSON.stringify({ wishes: currentWishes })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('status-msg').innerText = "ƒê√£ l∆∞u th√†nh c√¥ng! ‚úÖ";
                        setTimeout(() => document.getElementById('status-msg').innerText = "", 3000);
                    } else {
                        alert('L·ªói: ' + data.error);
                    }
                })
                .catch(err => alert('L·ªói k·∫øt n·ªëi'))
                .finally(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
        }
    </script>
</body>

</html>